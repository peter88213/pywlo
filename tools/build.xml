<?xml version="1.0" encoding="UTF-8"?>
<project name="pywriter_lo" basedir=".">
	<property name="release" value="0.20.0" />
	<property name="oxt_file" value="pywlo-${release}.oxt" />
	
	<property name="oxt" location="../oxt" />
	<property name="src" location="../src" />
	<property name="test" location="../test" />
	<property name="dist" location="../dist" />
	<property name="project-name" value="${ant.project.name}" />
	<property name="release-name" value="${project-name}_v${release}" />

	<target name="build" description="inline all library modules">
		
		<delete dir="${dist}" />
		<delete file="${test}/saveyw.py" />
		<delete file="${test}/openyw.py" />
			<exec executable="python" failonerror="true">
			    <arg value="${src}/build_saveyw.py"/>
			</exec>
			<exec executable="python" failonerror="true">
			    <arg value="${src}/build_openyw.py"/>
			</exec>
	</target>

	<target name="dist" description="generate the distribution">
		
		<mkdir dir="${dist}" />
		<mkdir dir="${dist}/pywlo-v${release}" />
		<mkdir dir="${dist}/pywlo-v${release}/Descriptions" />
		<mkdir dir="${dist}/pywlo-v${release}/icons" />
		<mkdir dir="${dist}/pywlo-v${release}/META-INF" />
		<mkdir dir="${dist}/pywlo-v${release}/pywlo" />
		<mkdir dir="${dist}/pywlo-v${release}/Tooltips" />

		<replace file="${test}/saveyw.py" token="@release" value="${release}" />
		<copy file="${test}/saveyw.py" todir="${dist}/pywlo-v${release}/pywlo" />

		<replace file="${test}/openyw.py" token="@release" value="${release}" />
		<copy file="${test}/openyw.py" todir="${dist}/pywlo-v${release}/pywlo" />

		<copy file="${oxt}/Descriptions/descr-de.txt" todir="${dist}/pywlo-v${release}/Descriptions" />
		<copy file="${oxt}/Descriptions/descr-en.txt" todir="${dist}/pywlo-v${release}/Descriptions" />
		
		<copy file="${oxt}/icons/yWriter_16.png" todir="${dist}/pywlo-v${release}/icons" />
		<copy file="${oxt}/icons/yWriter_26.png" todir="${dist}/pywlo-v${release}/icons" />

		<copy file="${oxt}/META-INF/manifest.xml" todir="${dist}/pywlo-v${release}/META-INF" />
		
		<copy file="${oxt}/Tooltips/tip-en.txt" todir="${dist}/pywlo-v${release}/Tooltips" />
		<copy file="${oxt}/Tooltips/tip-de.txt" todir="${dist}/pywlo-v${release}/Tooltips" />

		<replace file="${oxt}/AddonUI.xcu" token="|pywlo$|" value="|pywlo|" />
		<replace file="${oxt}/AddonUI.xcu" token="pywlo-L-" value="pywlo-" />
		<copy file="${oxt}/AddonUI.xcu" todir="${dist}/pywlo-v${release}" />
		<replace file="${dist}/pywlo-v${release}/AddonUI.xcu" token="0.99.0" value="${release}" />

		<copy file="${oxt}/description.xml" todir="${dist}/pywlo-v${release}" />
		<replace file="${dist}/pywlo-v${release}/description.xml" token="@release" value="${release}" />

		<copy file="../README.md" todir="${dist}/pywlo-v${release}" />
		<copy file="../LICENSE" todir="${dist}/pywlo-v${release}" />

		<zip destfile="${dist}/pywlo-v${release}.oxt" basedir="${dist}/pywlo-v${release}" />
	</target>

	<target name="clean" description="clean up">
		
		<!--delete file="${test}/saveyw.py" /-->
		<!--delete file="${test}/openyw.py" /-->
		
	</target>
	
</project>